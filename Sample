kubectl exec -n airflow pod/<scheduler-pod> -- ls -l /opt/airflow/dags


kubectl exec -n airflow pod/<scheduler-pod> -- sh -c "sed -n '1,20p' /opt/airflow/dags/sample_dag.py"



# 3) Try pulling the image (replace with your real image)
minikube ssh "sudo ctr images pull registry.gitlab.com/<your-path>/<your-image>:<tag>"

# 4) If pull fails, print recent containerd logs (TLS errors will show here)
minikube ssh "sudo journalctl -u containerd --since '5 minutes ago' -n 200 --no-pager | sed -n '1,200p'"
minikube ssh "ls -l /usr/local/share/ca-certificates || true"
minikube ssh "sudo ls -l /etc/ssl/certs | grep corp-ca || true"

minikube ssh "sudo update-ca-certificates --verbose"


minikube ssh "sudo openssl x509 -in /usr/local/share/ca-certificates/corp-ca.crt -noout -text | sed -n '1,8p' || echo 'cannot read CA file'"

minikube ssh "echo | openssl s_client -showcerts -servername registry.gitlab.com -connect registry.gitlab.com:443 2>/dev/null | sed -n '1,120p'"






 


# 1. Create registry config dir
minikube ssh "sudo mkdir -p /etc/containerd/certs.d/registry.gitlab.com"

# 2. Configure skip TLS verification
minikube ssh "sudo tee /etc/containerd/certs.d/registry.gitlab.com/hosts.toml > /dev/null <<'EOF'
[host.\"https://registry.gitlab.com\"]
  skip_verify = true
EOF"

# 3. Restart containerd
minikube ssh "sudo systemctl restart containerd"



minikube ssh "echo '{\"insecure-registries\":[\"registry.gitlab.com\"]}' | sudo tee /etc/docker/daemon.json"
minikube ssh "sudo systemctl restart docker"


minikube ssh "docker pull registry.gitlab.com/<your-path>/<your-image>:<tag>"
