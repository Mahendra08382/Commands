    # ----- Update DAGs ConfigMap -----
    - Write-Host "Updating airflow-dags ConfigMap..."
    - kubectl -n $Env:KUBE_NAMESPACE create configmap airflow-dags --from-file=dags/ --dry-run=client -o yaml | kubectl apply -f -

    # ----- Restart deployments so initContainers reload DAGs -----
    - Write-Host "Restarting Airflow deployments..."
    - kubectl -n $Env:KUBE_NAMESPACE rollout restart deploy/airflow-scheduler
    - kubectl -n $Env:KUBE_NAMESPACE rollout restart deploy/airflow-web

    # ----- Wait for rollouts (PowerShell-safe, no '||') -----
    - Write-Host "Waiting for airflow-scheduler rollout..."
    - $p = Start-Process -FilePath "kubectl" -ArgumentList @("rollout","status","deploy/airflow-scheduler","-n",$Env:KUBE_NAMESPACE,"--timeout=300s") -NoNewWindow -PassThru -Wait
    - if ($p.ExitCode -ne 0) { Write-Warning "airflow-scheduler rollout failed" }

    - Write-Host "Waiting for airflow-web rollout..."
    - $p = Start-Process -FilePath "kubectl" -ArgumentList @("rollout","status","deploy/airflow-web","-n",$Env:KUBE_NAMESPACE,"--timeout=300s") -NoNewWindow -PassThru -Wait
    - if ($p.ExitCode -ne 0) { Write-Warning "airflow-web rollout failed" }
